<!DOCTYPE html>
<html>
<head>
<title>Pheenix: Routine at 28637</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28563.html">28563</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28637">Map</a></td>
<td class="next">
Next: <a href="28720.html">28720</a>
</td>
</tr>
</table>
<div class="description">28637: Handler: Move Ship Right</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="28408.html">Handler_ShipMovement</a>.
</div>
<div class="paragraph">
Moves the player's ship one pixel to the right by shifting the ship graphic and updating the player position. Movement timing is controlled by the movement animation frame counter (counts down from 7 to 0).
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28637"></span>
<div class="comments">
<div class="paragraph">
Check if the ship is already at the right edge (221) and whether this frame should perform a movement step.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_MoveShip_Right</td>
<td class="address-2"><span id="28637"></span>28637</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore the player position from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28638"></span>28638</td>
<td class="instruction">CP 221</td>
<td class="comment-1" rowspan="1">Compare the player position with 221.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28640"></span>28640</td>
<td class="instruction">LD A,(26278)</td>
<td class="comment-1" rowspan="1">Load the movement animation frame counter from <a href="26278.html">MovementAnimationFrameCounter</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28643"></span>28643</td>
<td class="instruction">JR NZ,<a href="28637.html#28648">MoveShipRight_UpdateCounter</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28637.html#28648">MoveShipRight_UpdateCounter</a> if the ship is not at the right edge.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28645"></span>28645</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Jump to <a href="28563.html">Handler_UpdateShipPosition</a> if the movement animation frame counter is zero (skip movement while touching the edge).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28646"></span>28646</td>
<td class="instruction">JR Z,<a href="28563.html">Handler_UpdateShipPosition</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28648"></span>
<div class="comments">
<div class="paragraph">
Decrement the movement animation frame counter, wrapping from 0 back to 7. Only when the counter wraps (value 7) is the player position updated.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MoveShipRight_UpdateCounter</td>
<td class="address-2"><span id="28648"></span>28648</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Jump to <a href="28637.html#28654">MoveShipRight_ResetCounter</a> if the movement animation frame counter is zero (wrap to 7).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28649"></span>28649</td>
<td class="instruction">JR Z,<a href="28637.html#28654">MoveShipRight_ResetCounter</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28651"></span>28651</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrease the movement animation frame counter by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28652"></span>28652</td>
<td class="instruction">JR <a href="28637.html#28656">MoveShipRight_SaveCounter</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28637.html#28656">MoveShipRight_SaveCounter</a>.</td>
</tr>
<tr>
<td class="asm-label">MoveShipRight_ResetCounter</td>
<td class="address-2"><span id="28654"></span>28654</td>
<td class="instruction">LD A,7</td>
<td class="comment-1" rowspan="1">Load 7 into the movement animation frame counter.</td>
</tr>
<tr>
<td class="asm-label">MoveShipRight_SaveCounter</td>
<td class="address-2"><span id="28656"></span>28656</td>
<td class="instruction">LD (26278),A</td>
<td class="comment-1" rowspan="1">Write the updated counter back to *<a href="26278.html">MovementAnimationFrameCounter</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28659"></span>
<div class="comments">
<div class="paragraph">
Move the ship only when the counter has just wrapped (value 7).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28659"></span>28659</td>
<td class="instruction">CP 7</td>
<td class="comment-1" rowspan="1">Compare the counter with 7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28661"></span>28661</td>
<td class="instruction">LD A,(26349)</td>
<td class="comment-1" rowspan="1">Load the player position from <a href="26349.html">PlayerAttributeBufferPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28664"></span>28664</td>
<td class="instruction">JR NZ,<a href="28637.html#28670">MoveShipRight_Setup</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28637.html#28670">MoveShipRight_Setup</a> if the counter is not 7 (no movement on this frame).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28666"></span>28666</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment the player position by one (move right).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28667"></span>28667</td>
<td class="instruction">LD (26349),A</td>
<td class="comment-1" rowspan="1">Write the updated position to *<a href="26349.html">PlayerAttributeBufferPosition</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28670"></span>
<div class="comments">
<div class="paragraph">
Prepare the screen position and animate the ship graphic by shifting pixels to the right.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MoveShipRight_Setup</td>
<td class="address-2"><span id="28670"></span>28670</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Stash the ship position on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28671"></span>28671</td>
<td class="instruction">ADD A,2</td>
<td class="comment-1" rowspan="1">Add 2 to <span class="register">A</span> to point to the rightmost ship column.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28673"></span>28673</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">Copy the screen column into <span class="register">L</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28674"></span>28674</td>
<td class="instruction">LD B,2</td>
<td class="comment-1" rowspan="1">Set a height counter in <span class="register">B</span> for 2 rows (ship height).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28676"></span>
<div class="comments">
<div class="paragraph">
Process each row of the ship graphic.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MoveShipRight_RowLoop</td>
<td class="address-2"><span id="28676"></span>28676</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash the row counter and screen position on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28677"></span>28677</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28678"></span>28678</td>
<td class="instruction">LD B,8</td>
<td class="comment-1" rowspan="1">Set a line counter in <span class="register">B</span> for 8 pixel lines.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28680"></span>
<div class="comments">
<div class="paragraph">
Process each pixel line in the current row.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MoveShipRight_LineLoop</td>
<td class="address-2"><span id="28680"></span>28680</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash the line counter and screen position on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28681"></span>28681</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28682"></span>28682</td>
<td class="instruction">LD B,3</td>
<td class="comment-1" rowspan="1">Set a width counter in <span class="register">B</span> for 3 bytes (ship width).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28684"></span>
<div class="comments">
<div class="paragraph">
Shift each byte of the ship graphic right by one pixel, propagating the carry between adjacent bytes.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">MoveShipRight_ByteLoop</td>
<td class="address-2"><span id="28684"></span>28684</td>
<td class="instruction">SRL (HL)</td>
<td class="comment-1" rowspan="1">Shift the byte at *<span class="register">HL</span> right.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28686"></span>28686</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Move to the previous byte in the ship graphic.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28687"></span>28687</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-1" rowspan="1">Test bit 0 of the previous byte to see if a bit needs to carry.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28689"></span>28689</td>
<td class="instruction">RES 0,(HL)</td>
<td class="comment-1" rowspan="1">Clear bit 0 of that byte ready for the carry.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28691"></span>28691</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move back to the current byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28692"></span>28692</td>
<td class="instruction">JR Z,<a href="28637.html#28696">MoveShipRight_NextByte</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28637.html#28696">MoveShipRight_NextByte</a> if the width counter has reached zero (no carry to set).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28694"></span>28694</td>
<td class="instruction">SET 7,(HL)</td>
<td class="comment-1" rowspan="1">Set bit 7 of the current byte (propagate the carry from the left).</td>
</tr>
<tr>
<td class="asm-label">MoveShipRight_NextByte</td>
<td class="address-2"><span id="28696"></span>28696</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Move to the previous byte again.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28697"></span>28697</td>
<td class="instruction">DJNZ <a href="28637.html#28684">MoveShipRight_ByteLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the width counter by one and loop back to <a href="28637.html#28684">MoveShipRight_ByteLoop</a> until the 3 bytes are shifted.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28699"></span>
<div class="comments">
<div class="paragraph">
Clean up after shifting the line.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28699"></span>28699</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28700"></span>28700</td>
<td class="instruction">RES 7,(HL)</td>
<td class="comment-1" rowspan="1">Clear bit 7 of that byte (remove any overflow).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28702"></span>28702</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the screen position from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28703"></span>28703</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Move down one pixel line in the screen buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28704"></span>28704</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the line counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28705"></span>28705</td>
<td class="instruction">DJNZ <a href="28637.html#28680">MoveShipRight_LineLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the line counter by one and loop back to <a href="28637.html#28680">MoveShipRight_LineLoop</a> until all 8 lines are processed.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28707"></span>
<div class="comments">
<div class="paragraph">
Move to the next row and continue processing.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28707"></span>28707</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the screen position from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28708"></span>28708</td>
<td class="instruction">SET 5,L</td>
<td class="comment-1" rowspan="1">Move to the next row position (set bit 5 of <span class="register">L</span>, add 32).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28710"></span>28710</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the row counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28711"></span>28711</td>
<td class="instruction">DJNZ <a href="28637.html#28676">MoveShipRight_RowLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the row counter by one and loop back to <a href="28637.html#28676">MoveShipRight_RowLoop</a> until both rows are processed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28713"></span>28713</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore the ship position from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28714"></span>28714</td>
<td class="instruction">CALL <a href="27805.html">CheckCollision</a></td>
<td class="comment-1" rowspan="1">Call the collision detection routine at <a href="27805.html">CheckCollision</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28717"></span>28717</td>
<td class="instruction">JP <a href="28563.html">Handler_UpdateShipPosition</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28563.html">Handler_UpdateShipPosition</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<div class="comments">
<div class="paragraph">
Continue on to <a href="28563.html">Handler_UpdateShipPosition</a>.
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="28563.html">28563</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28637">Map</a></td>
<td class="next">
Next: <a href="28720.html">28720</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Megadodo Software &copy; 2025 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/pheenix/">Source code</a>.</div>
<div><a href="../../asm/6FDD.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>