<!DOCTYPE html>
<html>
<head>
<title>Pheenix: Routine at 28111</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27886.html">27886</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28111">Map</a></td>
<td class="next">
Next: <a href="28408.html">28408</a>
</td>
</tr>
</table>
<div class="description">28111: Handler: Shield</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="27886.html">Handler_PlayerDeathGameOver</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield</td>
<td class="address-2"><span id="28111"></span>28111</td>
<td class="instruction">CALL <a href="27805.html">CheckCollision</a></td>
<td class="comment-1" rowspan="1">Call <a href="27805.html">CheckCollision</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28114"></span>28114</td>
<td class="instruction">LD A,(26349)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="26349.html">PlayerAttributeBufferPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28117"></span>28117</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Stash the player position on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28118"></span>28118</td>
<td class="instruction">LD HL,26260</td>
<td class="comment-1" rowspan="4">Jump to <a href="28111.html#28136">Shield_CheckDemoMode</a> if *<a href="26260.html">ShieldTimer</a> isn't active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28121"></span>28121</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28122"></span>28122</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28123"></span>28123</td>
<td class="instruction">JR Z,<a href="28111.html#28136">Shield_CheckDemoMode</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28125"></span>
<div class="comments">
<div class="paragraph">
The players shield is active, so decrease the shield timer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28125"></span>28125</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Decrease *<a href="26260.html">ShieldTimer</a> by one.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28126"></span>
<div class="comments">
<div class="paragraph">
Check if the timer has "wrapped around" to 255 i.e. finished counting down.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28126"></span>28126</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="2">Jump to <a href="28111.html#28192">PlayShieldSound</a> if bit 7 of *<a href="26260.html">ShieldTimer</a> is set.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28128"></span>28128</td>
<td class="instruction">JR NZ,<a href="28111.html#28192">PlayShieldSound</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28130"></span>28130</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Write 0 ("inactive") to *<a href="26259.html">Flag_Shield</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28131"></span>28131</td>
<td class="instruction">LD (26259),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28134"></span>28134</td>
<td class="instruction">JR <a href="28111.html#28192">PlayShieldSound</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28111.html#28192">PlayShieldSound</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28136"></span>
<div class="comments">
<div class="paragraph">
Check for shield activation player inputs.
</div>
<div class="paragraph">
Start by checking if the game is running in demo mode or not?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_CheckDemoMode</td>
<td class="address-2"><span id="28136"></span>28136</td>
<td class="instruction">LD A,(26355)</td>
<td class="comment-1" rowspan="3">Jump to <a href="28111.html#28150">Shield_CheckKempston</a> if *<a href="26355.html">Flag_ActiveDemoMode</a> is not active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28139"></span>28139</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28140"></span>28140</td>
<td class="instruction">JR Z,<a href="28111.html#28150">Shield_CheckKempston</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28142"></span>
<div class="comments">
<div class="paragraph">
Demo mode is active, so use a random number to decide whether to activate the shield or not.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28142"></span>28142</td>
<td class="instruction">CALL <a href="26382.html">GenerateRandomNumber</a></td>
<td class="comment-1" rowspan="1">Call <a href="26382.html">GenerateRandomNumber</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28145"></span>28145</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Jump to <a href="28111.html#28187">Shield_ActivateShield</a> if the generated random number is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28146"></span>28146</td>
<td class="instruction">JR Z,<a href="28111.html#28187">Shield_ActivateShield</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28148"></span>28148</td>
<td class="instruction">JR <a href="28111.html#28192">PlayShieldSound</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28111.html#28192">PlayShieldSound</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28150"></span>
<div class="comments">
<div class="paragraph">
Check if the control method is the Kempston joystick?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_CheckKempston</td>
<td class="address-2"><span id="28150"></span>28150</td>
<td class="instruction">LD A,(26358)</td>
<td class="comment-1" rowspan="3">Jump to <a href="28111.html#28165">Shield_CheckAGF</a> if *<a href="26358.html">ControlMethod</a> is not the Kempston joystick.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28153"></span>28153</td>
<td class="instruction">CP 2</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28155"></span>28155</td>
<td class="instruction">JR NZ,<a href="28111.html#28165">Shield_CheckAGF</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28157"></span>
<div class="comments">
<div class="paragraph">
The control method is Kempston joystick, so test for "down" being pressed.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28157"></span>28157</td>
<td class="instruction">IN A,(31)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=read from the Kempston joystick port.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28159"></span>28159</td>
<td class="instruction">AND %00000100</td>
<td class="comment-1" rowspan="2">Jump to <a href="28111.html#28187">Shield_ActivateShield</a> if "down" (bit 2) is being pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28161"></span>28161</td>
<td class="instruction">JR NZ,<a href="28111.html#28187">Shield_ActivateShield</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28163"></span>28163</td>
<td class="instruction">JR <a href="28111.html#28192">PlayShieldSound</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28111.html#28192">PlayShieldSound</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28165"></span>
<div class="comments">
<div class="paragraph">
Check if the control method is the AGF joystick?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_CheckAGF</td>
<td class="address-2"><span id="28165"></span>28165</td>
<td class="instruction">CP 1</td>
<td class="comment-1" rowspan="2">Jump to <a href="28111.html#28179">Shield_CheckKeyboard</a> if *<a href="26358.html">ControlMethod</a> is not the AGF joystick.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28167"></span>28167</td>
<td class="instruction">JR NZ,<a href="28111.html#28179">Shield_CheckKeyboard</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28169"></span>
<div class="comments">
<div class="paragraph">
The control method is the AGF joystick, so test for "down" being pressed.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28169"></span>28169</td>
<td class="instruction">LD A,239</td>
<td class="comment-1" rowspan="2">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">239</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">9</td>
<td class="centre" colspan="1" rowspan="1">8</td>
<td class="centre" colspan="1" rowspan="1">7</td>
<td class="centre" colspan="1" rowspan="1">6</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28171"></span>28171</td>
<td class="instruction">IN A,(254)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28173"></span>28173</td>
<td class="instruction">BIT 4,A</td>
<td class="comment-1" rowspan="2">Jump to <a href="28111.html#28187">Shield_ActivateShield</a> if "down" ("4") was pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28175"></span>28175</td>
<td class="instruction">JR Z,<a href="28111.html#28187">Shield_ActivateShield</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28177"></span>28177</td>
<td class="instruction">JR <a href="28111.html#28192">PlayShieldSound</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28111.html#28192">PlayShieldSound</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28179"></span>
<div class="comments">
<div class="paragraph">
Else, the only control option left is the keyboard.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_CheckKeyboard</td>
<td class="address-2"><span id="28179"></span>28179</td>
<td class="instruction">LD A,191</td>
<td class="comment-1" rowspan="2">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">191</td>
<td class="centre" colspan="1" rowspan="1">ENTER</td>
<td class="centre" colspan="1" rowspan="1">L</td>
<td class="centre" colspan="1" rowspan="1">K</td>
<td class="centre" colspan="1" rowspan="1">J</td>
<td class="centre" colspan="1" rowspan="1">H</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28181"></span>28181</td>
<td class="instruction">IN A,(254)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28183"></span>28183</td>
<td class="instruction">AND %00000001</td>
<td class="comment-1" rowspan="2">Jump to <a href="28111.html#28192">PlayShieldSound</a> if "ENTER" isn't being pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28185"></span>28185</td>
<td class="instruction">JR NZ,<a href="28111.html#28192">PlayShieldSound</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28187"></span>
<div class="comments">
<div class="paragraph">
Activate the shield.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_ActivateShield</td>
<td class="address-2"><span id="28187"></span>28187</td>
<td class="instruction">LD (HL),255</td>
<td class="comment-1" rowspan="1">Write 255 to *<a href="26260.html">ShieldTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28189"></span>28189</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="2">Write 1 to *<a href="26259.html">Flag_Shield</a> to activate it.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28190"></span>28190</td>
<td class="instruction">LD (HL),1</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28192"></span>
<div class="comments">
<div class="paragraph">
Play a sound when the shield is active (but not in demo mode).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PlayShieldSound</td>
<td class="address-2"><span id="28192"></span>28192</td>
<td class="instruction">LD A,(26259)</td>
<td class="comment-1" rowspan="3">Jump to <a href="28408.html">Handler_ShipMovement</a> if *<a href="26259.html">Flag_Shield</a> is not active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28195"></span>28195</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28196"></span>28196</td>
<td class="instruction">JP Z,<a href="28408.html">Handler_ShipMovement</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28199"></span>28199</td>
<td class="instruction">LD A,(26355)</td>
<td class="comment-1" rowspan="3">Jump to <a href="28111.html#28224">DrawShield</a> if *<a href="26355.html">Flag_ActiveDemoMode</a> is active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28202"></span>28202</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28203"></span>28203</td>
<td class="instruction">JR NZ,<a href="28111.html#28224">DrawShield</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28205"></span>
<div class="comments">
<div class="paragraph">
Play an iteration of the shield sound effect.
</div>
<div class="paragraph">
<audio controls="" src="../../audio/shield.wav">
<p>Your browser doesn't support HTML5 audio. Here is a <a href="../../audio/shield.wav">link to the audio</a> instead.</p>
</audio>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28205"></span>28205</td>
<td class="instruction">LD A,(26260)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="26260.html">ShieldTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28208"></span>28208</td>
<td class="instruction">AND %00000111</td>
<td class="comment-1" rowspan="7">Calculate the sound pitch: 0222 + ((*<a href="26260.html">ShieldTimer</a> &amp; 7) Ã— 4).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28210"></span>28210</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28211"></span>28211</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28212"></span>28212</td>
<td class="instruction">LD HL,222</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28215"></span>28215</td>
<td class="instruction">LD D,H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28216"></span>28216</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28217"></span>28217</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28218"></span>28218</td>
<td class="instruction">LD E,4</td>
<td class="comment-1" rowspan="1">Set the duration in <span class="register">E</span> to 4.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28220"></span>28220</td>
<td class="instruction">CALL 949</td>
<td class="comment-1" rowspan="1">Call <a "noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/03B5.html">BEEPER</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28223"></span>28223</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="28224"></span>
<div class="comments">
<div class="paragraph">
Draw shield graphic.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">DrawShield</td>
<td class="address-2"><span id="28224"></span>28224</td>
<td class="instruction">LD HL,(26349)</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=*<a href="26349.html">PlayerAttributeBufferPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28227"></span>28227</td>
<td class="instruction">LD H,82</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=82.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28229"></span>28229</td>
<td class="instruction">LD B,2</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=2.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28231"></span>28231</td>
<td class="instruction">LD A,(26278)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="26278.html">BulletIndex</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28234"></span>28234</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Stash <span class="register">AF</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_0</td>
<td class="address-2"><span id="28235"></span>28235</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Set the bits from <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28236"></span>28236</td>
<td class="instruction">LD DE,0</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=0000.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28239"></span>28239</td>
<td class="instruction">JR NZ,<a href="28111.html#28258">Handler_Shield_1</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28111.html#28258">Handler_Shield_1</a> if <span class="register">HL</span> is not equal to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28241"></span>28241</td>
<td class="instruction">LD A,(26260)</td>
<td class="comment-1" rowspan="3">Jump to <a href="28111.html#28258">Handler_Shield_1</a> if bit 2 of *<a href="26260.html">ShieldTimer</a> is not set.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28244"></span>28244</td>
<td class="instruction">BIT 2,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28246"></span>28246</td>
<td class="instruction">JR Z,<a href="28111.html#28258">Handler_Shield_1</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28248"></span>28248</td>
<td class="instruction">LD DE,310</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=0310.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28251"></span>28251</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="3">Jump to <a href="28111.html#28258">Handler_Shield_1</a> if <span class="register">B</span> is not equal to 1.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28252"></span>28252</td>
<td class="instruction">CP 1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28254"></span>28254</td>
<td class="instruction">JR NZ,<a href="28111.html#28258">Handler_Shield_1</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28256"></span>28256</td>
<td class="instruction">LD D,128</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=128.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_1</td>
<td class="address-2"><span id="28258"></span>28258</td>
<td class="instruction">LD (28295),DE</td>
<td class="comment-1" rowspan="1">Write <span class="register">DE</span> to *<a href="28111.html#28295">28295</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28262"></span>28262</td>
<td class="instruction">LD (28314),DE</td>
<td class="comment-1" rowspan="1">Write <span class="register">DE</span> to *<a href="28111.html#28314">28314</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28266"></span>28266</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore <span class="register">AF</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28267"></span>28267</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment <span class="register">A</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28268"></span>28268</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash <span class="register">BC</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28269"></span>28269</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28270"></span>28270</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28271"></span>28271</td>
<td class="instruction">LD HL,28294</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="28111.html#28293">28294</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28274"></span>28274</td>
<td class="instruction">LD A,(26260)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="26260.html">ShieldTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28277"></span>28277</td>
<td class="instruction">BIT 2,A</td>
<td class="comment-1" rowspan="1">Test bit 2 of <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28279"></span>28279</td>
<td class="instruction">LD A,126</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=126.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28281"></span>28281</td>
<td class="instruction">JR Z,<a href="28111.html#28285">Handler_Shield_2</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28111.html#28285">Handler_Shield_2</a> if <span class="register">A</span> is equal to 126.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28283"></span>28283</td>
<td class="instruction">ADD A,64</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=64.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_2</td>
<td class="address-2"><span id="28285"></span>28285</td>
<td class="instruction">ADD A,8</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>+=8.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28287"></span>28287</td>
<td class="instruction">DJNZ <a href="28111.html#28285">Handler_Shield_2</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="28111.html#28285">Handler_Shield_2</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28289"></span>28289</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28290"></span>28290</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28291"></span>28291</td>
<td class="instruction">LD B,6</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=6.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_3</td>
<td class="address-2"><span id="28293"></span>28293</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-1" rowspan="1">Set bit 0 of *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28295"></span>28295</td>
<td class="instruction">LD (HL),1</td>
<td class="comment-1" rowspan="1">Write 1 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28297"></span>28297</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Increment <span class="register">H</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28298"></span>28298</td>
<td class="instruction">DJNZ <a href="28111.html#28293">Handler_Shield_3</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="28111.html#28293">Handler_Shield_3</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28300"></span>28300</td>
<td class="instruction">LD A,(28294)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="28111.html#28293">28294</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28303"></span>28303</td>
<td class="instruction">LD (28313),A</td>
<td class="comment-1" rowspan="1">Write <span class="register">A</span> to *<a href="28111.html#28312">28313</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28306"></span>28306</td>
<td class="instruction">SET 5,L</td>
<td class="comment-1" rowspan="1">Set bit 5 of <span class="register">L</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28308"></span>28308</td>
<td class="instruction">LD H,80</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=80.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28310"></span>28310</td>
<td class="instruction">LD B,8</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=8.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_4</td>
<td class="address-2"><span id="28312"></span>28312</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-1" rowspan="1">Set bit 0 of *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28314"></span>28314</td>
<td class="instruction">LD (HL),1</td>
<td class="comment-1" rowspan="1">Write 1 to *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28316"></span>28316</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Increment <span class="register">H</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28317"></span>28317</td>
<td class="instruction">DJNZ <a href="28111.html#28312">Handler_Shield_4</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="28111.html#28312">Handler_Shield_4</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28319"></span>28319</td>
<td class="instruction">LD HL,(26349)</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=*<a href="26349.html">PlayerAttributeBufferPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28322"></span>28322</td>
<td class="instruction">LD H,82</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=82.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28324"></span>28324</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="2">Increment <span class="register">L</span> by two.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28325"></span>28325</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28326"></span>28326</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28327"></span>28327</td>
<td class="instruction">LD A,(26278)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="26278.html">BulletIndex</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28330"></span>28330</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Stash <span class="register">AF</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28331"></span>28331</td>
<td class="instruction">SUB 7</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>-=7.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28333"></span>28333</td>
<td class="instruction">DJNZ <a href="28111.html#28235">Handler_Shield_0</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="28111.html#28235">Handler_Shield_0</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28335"></span>28335</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore <span class="register">AF</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28336"></span>28336</td>
<td class="instruction">LD A,(26260)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="26260.html">ShieldTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28339"></span>28339</td>
<td class="instruction">BIT 2,A</td>
<td class="comment-1" rowspan="1">Test bit 2 of <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28341"></span>28341</td>
<td class="instruction">LD HL,24596</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="24596.html">Graphics_Shield_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28344"></span>28344</td>
<td class="instruction">JR Z,<a href="28111.html#28349">Handler_Shield_5</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28111.html#28349">Handler_Shield_5</a> if <span class="register">L</span> is equal to 82.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28346"></span>28346</td>
<td class="instruction">LD HL,24605</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="24596.html#24605">Graphics_Shield_02</a>.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_5</td>
<td class="address-2"><span id="28349"></span>28349</td>
<td class="instruction">LD DE,24955</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="24923.html#24955">24955</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28352"></span>28352</td>
<td class="instruction">LD C,9</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=9.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28354"></span>28354</td>
<td class="instruction">LDIR</td>
<td class="comment-1" rowspan="1">LDIR.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28356"></span>28356</td>
<td class="instruction">LD A,(26278)</td>
<td class="comment-1" rowspan="3">Jump to <a href="28111.html#28385">Handler_Shield_9</a> if *<a href="26278.html">BulletIndex</a> is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28359"></span>28359</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28360"></span>28360</td>
<td class="instruction">JR Z,<a href="28111.html#28385">Handler_Shield_9</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28362"></span>28362</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=*<a href="26278.html">BulletIndex</a>.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_6</td>
<td class="address-2"><span id="28363"></span>28363</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash <span class="register">BC</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28364"></span>28364</td>
<td class="instruction">LD HL,24955</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="24923.html#24955">24955</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28367"></span>28367</td>
<td class="instruction">LD B,9</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=9.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_7</td>
<td class="address-2"><span id="28369"></span>28369</td>
<td class="instruction">SLA (HL)</td>
<td class="comment-1" rowspan="1">Shift *<span class="register">HL</span> left (with carry).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28371"></span>28371</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28372"></span>28372</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Test bit 7 of *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28374"></span>28374</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28375"></span>28375</td>
<td class="instruction">JR Z,<a href="28111.html#28379">Handler_Shield_8</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="28111.html#28379">Handler_Shield_8</a> if <span class="register">HL</span> is equal to <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28377"></span>28377</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-1" rowspan="1">Set bit 0 of *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_8</td>
<td class="address-2"><span id="28379"></span>28379</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Increment <span class="register">HL</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28380"></span>28380</td>
<td class="instruction">DJNZ <a href="28111.html#28369">Handler_Shield_7</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="28111.html#28369">Handler_Shield_7</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28382"></span>28382</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28383"></span>28383</td>
<td class="instruction">DJNZ <a href="28111.html#28363">Handler_Shield_6</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="28111.html#28363">Handler_Shield_6</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield_9</td>
<td class="address-2"><span id="28385"></span>28385</td>
<td class="instruction">LD DE,(26349)</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=*<a href="26349.html">PlayerAttributeBufferPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28389"></span>28389</td>
<td class="instruction">LD D,80</td>
<td class="comment-1" rowspan="1"><span class="register">D</span>=80.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28391"></span>28391</td>
<td class="instruction">LD HL,24955</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="24923.html#24955">24955</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28394"></span>28394</td>
<td class="instruction">LD B,3</td>
<td class="comment-1" rowspan="1">Set counter in <span class="register">B</span> for 3 pixel rows.</td>
</tr>
<tr>
<td class="asm-label">DrawPlayersShip_Loop</td>
<td class="address-2"><span id="28396"></span>28396</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash the row counter and position on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28397"></span>28397</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28398"></span>28398</td>
<td class="instruction">LD BC,3</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=0003.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28401"></span>28401</td>
<td class="instruction">LDIR</td>
<td class="comment-1" rowspan="1">LDIR.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28403"></span>28403</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore <span class="register">DE</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28404"></span>28404</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Increment <span class="register">D</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28405"></span>28405</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="28406"></span>28406</td>
<td class="instruction">DJNZ <a href="28111.html#28396">DrawPlayersShip_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="28111.html#28396">DrawPlayersShip_Loop</a> until counter is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<div class="comments">
<div class="paragraph">
Continue on to <a href="28408.html">Handler_ShipMovement</a>.
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="27886.html">27886</a>
</td>
<td class="up">Up: <a href="../maps/all.html#28111">Map</a></td>
<td class="next">
Next: <a href="28408.html">28408</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Megadodo Software &copy; 2025 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/pheenix/">Source code</a>.</div>
<div><a href="../../asm/6DCF.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>