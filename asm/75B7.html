<!DOCTYPE html>
<html>
<head>
<title>Pheenix: Routine at 75B7</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="75AD.html">75AD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#75b7">Map</a></td>
<td class="next">
Next: <a href="7616.html">7616</a>
</td>
</tr>
</table>
<div class="description">75B7: Handler: Pheenix</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="7616.html">7616</a>.
</div>
<div class="paragraph">
This is a fairly dogmatic sprite drawing routine, and hopefully this will explain why there are empty blocks seemingly randomly in the Pheenix sprite data.
</div>
<div class="paragraph">
This routine always assumes the Pheenix sprite data looks like this: <table class="">
<tr>
<td class="" colspan="1" rowspan="1">X</td>
<td class="" colspan="1" rowspan="1">X</td>
<td class="" colspan="1" rowspan="1">X</td>
</tr>
<tr>
<td class="" colspan="1" rowspan="1"></td>
<td class="" colspan="1" rowspan="1">X</td>
<td class="" colspan="1" rowspan="1"></td>
</tr>
</table> However the sprites aren't always in that format, sometimes they have a single row of 02 UDGs - so in order to use the same routine the sprites "share" empty UDGs, so although something is written, it's just all 00.
</div>
<div class="paragraph">
Lastly, to conserve on space - some UDGs are less than 08 line bytes, they just share the bytes from the following sprite data. So some sprites end with empty bytes, and some start with empty bytes (which are shared between each).
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Screen buffer sprite destination</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75b7"></span>
<div class="comments">
<div class="paragraph">
Display frame 01 (the egg stage).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_01</td>
<td class="address-2"><span id="75b7"></span>75B7</td>
<td class="instruction">LD HL,$60E7</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="60E7.html">Graphics_Pheenix_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75ba"></span>75BA</td>
<td class="instruction">JR <a href="75B7.html#75bf">Handler_Pheenix_SingleRow</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="75B7.html#75bf">Handler_Pheenix_SingleRow</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75bc"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="7616.html">7616</a>.
</div>
<div class="paragraph">
Display frame 02 (the egg breaking apart).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_02</td>
<td class="address-2"><span id="75bc"></span>75BC</td>
<td class="instruction">LD HL,$60FF</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="60E7.html#60ff">Graphics_Pheenix_02</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75bf"></span>
<div class="comments">
<div class="paragraph">
Handler for single row sprites (as the second row is invisible).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_SingleRow</td>
<td class="address-2"><span id="75bf"></span>75BF</td>
<td class="instruction">LD BC,$0505</td>
<td class="comment-1" rowspan="1">Set <span class="register">BC</span> to CYAN / CYAN (centre and righthand blocks of the top and only row).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75c2"></span>75C2</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Write BLACK to the low byte of <span class="register">IX</span> (the lefthand block of the top row - which is an empty block).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75c3"></span>75C3</td>
<td class="instruction">LD IXl,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75c5"></span>75C5</td>
<td class="instruction">JR <a href="75B7.html#75e0">Handler_Pheenix_Draw</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="75B7.html#75e0">Handler_Pheenix_Draw</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75c7"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="7616.html">7616</a>.
</div>
<div class="paragraph">
Display frame 03 (the broken egg with a baby Pheenix).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_03</td>
<td class="address-2"><span id="75c7"></span>75C7</td>
<td class="instruction">LD HL,$611F</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="60E7.html#611f">Graphics_Pheenix_03</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75ca"></span>75CA</td>
<td class="instruction">LD B,$05</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span> to CYAN (righthand block of top row/ shell colour).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75cc"></span>75CC</td>
<td class="instruction">LD A,($667D)</td>
<td class="comment-1" rowspan="2"><span class="register">C</span>=*<a href="667D.html">Pheenix_Colour_01</a> (the centre colour of the top row/ Pheenix body).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75cf"></span>75CF</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75d0"></span>75D0</td>
<td class="instruction">JR <a href="75B7.html#75de">Handler_Pheenix_SetColour</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="75B7.html#75de">Handler_Pheenix_SetColour</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75d2"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="7616.html">7616</a>.
</div>
<div class="paragraph">
Display frame 05 (Pheenix wings "up").
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_05</td>
<td class="address-2"><span id="75d2"></span>75D2</td>
<td class="instruction">LD HL,$6185</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="615B.html#6185">Graphics_Pheenix_05</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75d5"></span>75D5</td>
<td class="instruction">JR <a href="75B7.html#75da">Handler_Pheenix_LoadColours</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="75B7.html#75da">Handler_Pheenix_LoadColours</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75d7"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="7616.html">7616</a>.
</div>
<div class="paragraph">
Display frame 04 (Pheenix wings "down").
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_04</td>
<td class="address-2"><span id="75d7"></span>75D7</td>
<td class="instruction">LD HL,$615B</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="615B.html">Graphics_Pheenix_04</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75da"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="75AD.html">Handler_BirdAlien_01</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_LoadColours</td>
<td class="address-2"><span id="75da"></span>75DA</td>
<td class="instruction">LD BC,($667D)</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span> to *<a href="667D.html">Pheenix_Colour_01</a> (righthand block of top row) and set <span class="register">C</span> to *<a href="667D.html#667e">Pheenix_Colour_02</a> (middle block of top row).</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_SetColour</td>
<td class="address-2"><span id="75de"></span>75DE</td>
<td class="instruction">LD IXl,B</td>
<td class="comment-1" rowspan="1">Write <span class="register">B</span> to the low byte of <span class="register">IX</span> which is used for colouring the lefthand block of the top row.</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_Draw</td>
<td class="address-2"><span id="75e0"></span>75E0</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="3">Stash the screen buffer destination, colour pair and screen buffer destination (again) on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75e1"></span>75E1</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75e2"></span>75E2</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75e3"></span>
<div class="comments">
<div class="paragraph">
All Pheenix sprites are 03 columns in the top row.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75e3"></span>75E3</td>
<td class="instruction">LD B,$03</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for 03 columns.</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_ColumnLoop</td>
<td class="address-2"><span id="75e5"></span>75E5</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash the column counter and screen buffer pointer on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75e6"></span>75E6</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75e7"></span>
<div class="comments">
<div class="paragraph">
Draw the UDG to the screen buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75e7"></span>75E7</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">Set a line counter in <span class="register">B</span> (08 lines in a UDG).</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_LineLoop</td>
<td class="address-2"><span id="75e9"></span>75E9</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="2">Copy the UDG data to the screen buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75ea"></span>75EA</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75eb"></span>75EB</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next UDG graphic data byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75ec"></span>75EC</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Move down one pixel line in the screen buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75ed"></span>75ED</td>
<td class="instruction">DJNZ <a href="75B7.html#75e9">Handler_Pheenix_LineLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the line counter by one and loop back to <a href="75B7.html#75e9">Handler_Pheenix_LineLoop</a> until all 08 lines of the UDG character have been drawn.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75ef"></span>75EF</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the original screen buffer location from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75f0"></span>75F0</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Move right one character block.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75f1"></span>75F1</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the column counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75f2"></span>75F2</td>
<td class="instruction">DJNZ <a href="75B7.html#75e5">Handler_Pheenix_ColumnLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the column counter by one and loop back to <a href="75B7.html#75e5">Handler_Pheenix_ColumnLoop</a> until all three columns of this row have been drawn.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75f4"></span>75F4</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="2">Restore the screen buffer destination and colour pair from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75f5"></span>75F5</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75f6"></span>75F6</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash the UDG data pointer on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75f7"></span>75F7</td>
<td class="instruction">CALL <a href="66F7.html">ConvertScreenToAttributeBufferAddress</a></td>
<td class="comment-1" rowspan="1">Call <a href="66F7.html">ConvertScreenToAttributeBufferAddress</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75fa"></span>75FA</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Exchange the <span class="register">DE</span> and <span class="register">HL</span> registers.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="75fb"></span>
<div class="comments">
<div class="paragraph">
Colour the top row of the Pheenix sprite.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75fb"></span>75FB</td>
<td class="instruction">LD A,IXl</td>
<td class="comment-1" rowspan="2">Write the colour held by the low byte of <span class="register">IX</span> to the attribute buffer pointer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75fd"></span>75FD</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75fe"></span>75FE</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move right one attribute block.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="75ff"></span>75FF</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-1" rowspan="1">Write the colour held by <span class="register">C</span> to the attribute buffer pointer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7600"></span>7600</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move right one attribute block.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7601"></span>7601</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-1" rowspan="1">Write the colour held by <span class="register">B</span> to the attribute buffer pointer.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7602"></span>
<div class="comments">
<div class="paragraph">
Colour the bottom row of the Pheenix sprite (feet, or an empty block).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7602"></span>7602</td>
<td class="instruction">LD BC,$001F</td>
<td class="comment-1" rowspan="2">Move the attribute buffer pointer to the row below the current row and left one attribute block (by adding 001F).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7605"></span>7605</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7606"></span>7606</td>
<td class="instruction">LD (HL),$06</td>
<td class="comment-1" rowspan="1">Write YELLOW to the attribute buffer pointer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7608"></span>7608</td>
<td class="instruction">CALL <a href="6704.html">ConvertAttributeToScreenBufferAddress</a></td>
<td class="comment-1" rowspan="1">Call <a href="6704.html">ConvertAttributeToScreenBufferAddress</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="760b"></span>
<div class="comments">
<div class="paragraph">
Now draw the bottom row (feet, or empty block).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="760b"></span>760B</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the UDG pointer from the stack.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="760c"></span>
<div class="comments">
<div class="paragraph">
Draw the UDG to the screen buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="760c"></span>760C</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">Set a line counter in <span class="register">B</span> (08 lines in a UDG).</td>
</tr>
<tr>
<td class="asm-label">Handler_Pheenix_BottomRowLoop</td>
<td class="address-2"><span id="760e"></span>760E</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="2">Copy the UDG data to the screen buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="760f"></span>760F</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7610"></span>7610</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Move down one pixel line in the screen buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7611"></span>7611</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Move to the next UDG graphic data byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7612"></span>7612</td>
<td class="instruction">DJNZ <a href="75B7.html#760e">Handler_Pheenix_BottomRowLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the line counter by one and loop back to <a href="75B7.html#760e">Handler_Pheenix_BottomRowLoop</a> until all 08 lines of the UDG character have been drawn.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7614"></span>7614</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the original screen buffer location from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7615"></span>7615</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="75AD.html">75AD</a>
</td>
<td class="up">Up: <a href="../maps/all.html#75b7">Map</a></td>
<td class="next">
Next: <a href="7616.html">7616</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Megadodo Software &copy; 2025 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/pheenix/">Source code</a>.</div>
<div><a href="../dec/asm/30135.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>