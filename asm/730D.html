<!DOCTYPE html>
<html>
<head>
<title>Pheenix: Routine at 730D</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="72C9.html">72C9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#730d">Map</a></td>
<td class="next">
Next: <a href="7407.html">7407</a>
</td>
</tr>
</table>
<div class="description">730D: Handler: Display Mothership Bonus</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="7254.html">Handler_LevelReset</a>.
</div>
<div class="paragraph">
Displays the bonus screen after completing the mothership level (phase 4).
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="730d"></span>
<div class="comments">
<div class="paragraph">
Only continue if; <ul class="">
<li>*<a href="66A4.html">Flag_Collision</a> has no collision detected</li>
<li>*<a href="66F1.html">Phase</a> is phase 4</li>
<li>*<a href="66D3.html">MothershipAlienState</a> has been hit</li>
</ul>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_DisplayMothershipBonus</td>
<td class="address-2"><span id="730d"></span>730D</td>
<td class="instruction">LD A,($66A4)</td>
<td class="comment-1" rowspan="3">Return if *<a href="66A4.html">Flag_Collision</a> is equal to 01.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7310"></span>7310</td>
<td class="instruction">CP $01</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7312"></span>7312</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7313"></span>7313</td>
<td class="instruction">LD A,($66F1)</td>
<td class="comment-1" rowspan="3">Jump to <a href="7407.html">Check_InitialiseLevel</a> if *<a href="66F1.html">Phase</a> is not equal to 04.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7316"></span>7316</td>
<td class="instruction">CP $04</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7318"></span>7318</td>
<td class="instruction">JP NZ,<a href="7407.html">Check_InitialiseLevel</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="731b"></span>731B</td>
<td class="instruction">LD A,($66D3)</td>
<td class="comment-1" rowspan="3">Return if *<a href="66D3.html">MothershipAlienState</a> is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="731e"></span>731E</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="731f"></span>731F</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7320"></span>
<div class="comments">
<div class="paragraph">
Display a bonus screen with star background.
</div>
<div class="paragraph">
First fill the screen with the star UDG character (note they're written in INK:BLACK,
PAPER:BLACK so they're not yet visible - this is just an example in INK:CYAN,
PAPER:BLACK (BRIGHT) to show what is happening at this point).
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Frame</th>
<th colspan="1" rowspan="1">Output</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">01</td>
<td class="centre" colspan="1" rowspan="1"><img alt="fill-3" src="../images/scr/fill-3.png" /></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7320"></span>7320</td>
<td class="instruction">CALL <a href="6720.html">ClearScreen</a></td>
<td class="comment-1" rowspan="1">Call <a href="6720.html">ClearScreen</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7323"></span>7323</td>
<td class="instruction">LD DE,$61DB</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="61DB.html">Graphics_StarLarge</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7326"></span>7326</td>
<td class="instruction">CALL <a href="6B31.html">FillScreenWithUDG</a></td>
<td class="comment-1" rowspan="1">Call <a href="6B31.html">FillScreenWithUDG</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7329"></span>
<div class="comments">
<div class="paragraph">
Print the bonus score text. <table class="default">
<tr>
<th colspan="1" rowspan="1">Frame</th>
<th colspan="1" rowspan="1">Output</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">02</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-1" src="../images/scr/bonus-1.png" /></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7329"></span>7329</td>
<td class="instruction">LD DE,$486E</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=486E (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="732c"></span>732C</td>
<td class="instruction">LD BC,$0445</td>
<td class="comment-1" rowspan="1">Printing 04 characters in INK:CYAN,
PAPER:BLACK (BRIGHT).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="732f"></span>732F</td>
<td class="instruction">LD HL,$652B</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="6528.html#652b">BonusScoreBuffer</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7332"></span>
<div class="comments">
<div class="paragraph">
Calculate the bonus digit.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7332"></span>7332</td>
<td class="instruction">LD A,($667F)</td>
<td class="comment-1" rowspan="1">Load *<a href="667F.html">AlienCount</a> (the number of aliens in the current level) into <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7335"></span>7335</td>
<td class="instruction">SRA A</td>
<td class="comment-1" rowspan="2">Divide by 02 and add 34 (ASCII "4").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7337"></span>7337</td>
<td class="instruction">ADD A,$34</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7339"></span>7339</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write the result to the score buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="733a"></span>733A</td>
<td class="instruction">CALL <a href="676F.html">Configurable_PrintString</a></td>
<td class="comment-1" rowspan="1">Call <a href="676F.html">Configurable_PrintString</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="733d"></span>
<div class="comments">
<div class="paragraph">
Print it again... <table class="default">
<tr>
<th colspan="1" rowspan="1">Frame</th>
<th colspan="1" rowspan="1">Output</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">03</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-2" src="../images/scr/bonus-2.png" /></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="733d"></span>733D</td>
<td class="instruction">LD HL,$652B</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="6528.html#652b">BonusScoreBuffer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7340"></span>7340</td>
<td class="instruction">LD E,$8E</td>
<td class="comment-1" rowspan="1">Update the printing location to 488E.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7342"></span>7342</td>
<td class="instruction">LD B,$04</td>
<td class="comment-1" rowspan="1">Printing 04 characters.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7344"></span>7344</td>
<td class="instruction">CALL <a href="676F.html">Configurable_PrintString</a></td>
<td class="comment-1" rowspan="1">Call <a href="676F.html">Configurable_PrintString</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7347"></span>
<div class="comments">
<div class="paragraph">
Smoosh the top score down: <table class="default">
<tr>
<th colspan="1" rowspan="1">Frame</th>
<th colspan="1" rowspan="1">Output</th>
<th colspan="1" rowspan="1">Frame</th>
<th colspan="1" rowspan="1">Output</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">04</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-3" src="../images/scr/bonus-3.png" /></td>
<td class="centre" colspan="1" rowspan="1">05</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-4" src="../images/scr/bonus-4.png" /></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">06</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-5" src="../images/scr/bonus-5.png" /></td>
<td class="centre" colspan="1" rowspan="1">07</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-6" src="../images/scr/bonus-6.png" /></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7347"></span>7347</td>
<td class="instruction">LD C,$04</td>
<td class="comment-1" rowspan="1">Set a row counter in <span class="register">C</span> to 04.</td>
</tr>
<tr>
<td class="asm-label">BonusScrollTop_RowLoop</td>
<td class="address-2"><span id="7349"></span>7349</td>
<td class="instruction">LD HL,$4E6B</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=4E6B (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="734c"></span>734C</td>
<td class="instruction">LD DE,$4F6B</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=4F6B (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="734f"></span>734F</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">Set a line counter in <span class="register">B</span> (08 lines in a UDG).</td>
</tr>
<tr>
<td class="asm-label">BonusScrollTop_LineLoop</td>
<td class="address-2"><span id="7351"></span>7351</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash <span class="register">BC</span> and <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7352"></span>7352</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7353"></span>7353</td>
<td class="instruction">LD BC,$000A</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=000A.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7356"></span>7356</td>
<td class="instruction">LDIR</td>
<td class="comment-1" rowspan="1">LDIR.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7358"></span>7358</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore <span class="register">DE</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7359"></span>7359</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Stash <span class="register">DE</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="735a"></span>735A</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="735b"></span>735B</td>
<td class="instruction">DEC H</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">H</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="735c"></span>735C</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="735d"></span>735D</td>
<td class="instruction">DJNZ <a href="730D.html#7351">BonusScrollTop_LineLoop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="730D.html#7351">BonusScrollTop_LineLoop</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="735f"></span>735F</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">C</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7360"></span>7360</td>
<td class="instruction">JR NZ,<a href="730D.html#7349">BonusScrollTop_RowLoop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="730D.html#7349">BonusScrollTop_RowLoop</a> until <span class="register">C</span> is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7362"></span>
<div class="comments">
<div class="paragraph">
Smoosh the bottom score up: <table class="default">
<tr>
<th colspan="1" rowspan="1">Frame</th>
<th colspan="1" rowspan="1">Output</th>
<th colspan="1" rowspan="1">Frame</th>
<th colspan="1" rowspan="1">Output</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">08</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-7" src="../images/scr/bonus-7.png" /></td>
<td class="centre" colspan="1" rowspan="1">09</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-8" src="../images/scr/bonus-8.png" /></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">0A</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-9" src="../images/scr/bonus-9.png" /></td>
<td class="centre" colspan="1" rowspan="1">0B</td>
<td class="centre" colspan="1" rowspan="1"><img alt="bonus-10" src="../images/scr/bonus-10.png" /></td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7362"></span>7362</td>
<td class="instruction">LD C,$04</td>
<td class="comment-1" rowspan="1"><span class="register">C</span>=04.</td>
</tr>
<tr>
<td class="asm-label">BonusScrollBottom_RowLoop</td>
<td class="address-2"><span id="7364"></span>7364</td>
<td class="instruction">LD HL,$498B</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=498B (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7367"></span>7367</td>
<td class="instruction">LD DE,$488B</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=488B (screen buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="736a"></span>736A</td>
<td class="instruction">LD B,$07</td>
<td class="comment-1" rowspan="1"><span class="register">B</span>=07.</td>
</tr>
<tr>
<td class="asm-label">BonusScrollBottom_LineLoop</td>
<td class="address-2"><span id="736c"></span>736C</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash <span class="register">BC</span> and <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="736d"></span>736D</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="736e"></span>736E</td>
<td class="instruction">LD BC,$000A</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=000A.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7371"></span>7371</td>
<td class="instruction">LDIR</td>
<td class="comment-1" rowspan="1">LDIR.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7373"></span>7373</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore <span class="register">DE</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7374"></span>7374</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Stash <span class="register">DE</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7375"></span>7375</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7376"></span>7376</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Increment <span class="register">H</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7377"></span>7377</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7378"></span>7378</td>
<td class="instruction">DJNZ <a href="730D.html#736c">BonusScrollBottom_LineLoop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="730D.html#736c">BonusScrollBottom_LineLoop</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="737a"></span>737A</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">C</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="737b"></span>737B</td>
<td class="instruction">JR NZ,<a href="730D.html#7364">BonusScrollBottom_RowLoop</a></td>
<td class="comment-1" rowspan="1">Jump back to <a href="730D.html#7364">BonusScrollBottom_RowLoop</a> until <span class="register">C</span> is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="737d"></span>737D</td>
<td class="instruction">CALL <a href="67B6.html">Handler_Score</a></td>
<td class="comment-1" rowspan="1">Call <a href="67B6.html">Handler_Score</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7380"></span>
<div class="comments">
<div class="paragraph">
Animate the bonus frame shimmering effect.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7380"></span>7380</td>
<td class="instruction">LD IX,$0000</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=0000.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7384"></span>7384</td>
<td class="instruction">LD B,$10</td>
<td class="comment-1" rowspan="1">Set an outer counter to 10.</td>
</tr>
<tr>
<td class="asm-label">BonusAnimation_OuterLoop</td>
<td class="address-2"><span id="7386"></span>7386</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the outer counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7387"></span>7387</td>
<td class="instruction">LD B,$0B</td>
<td class="comment-1" rowspan="1">Set an inner counter to 0B.</td>
</tr>
<tr>
<td class="asm-label">BonusAnimation_InnerLoop</td>
<td class="address-2"><span id="7389"></span>7389</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the inner counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="738a"></span>738A</td>
<td class="instruction">PUSH IX</td>
<td class="comment-1" rowspan="1">Stash <span class="register">IX</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="738c"></span>738C</td>
<td class="instruction">LD HL,$594A</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=594A (attribute buffer location).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="738f"></span>738F</td>
<td class="instruction">LD DE,$030B</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span> to initial frame dimensions (width=0B, height=03).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7392"></span>7392</td>
<td class="instruction">LD A,$0C</td>
<td class="comment-1" rowspan="3"><span class="register">B</span>=0C-<span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7394"></span>7394</td>
<td class="instruction">SUB B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7395"></span>7395</td>
<td class="instruction">LD B,A</td>
</tr>
<tr>
<td class="asm-label">BonusAnimation_FrameLoop</td>
<td class="address-2"><span id="7396"></span>7396</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash <span class="register">BC</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7397"></span>7397</td>
<td class="instruction">LD A,IXl</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=the low byte of <span class="register">IX</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7399"></span>7399</td>
<td class="instruction">AND %00111111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-5.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="739b"></span>739B</td>
<td class="instruction">LD B,E</td>
<td class="comment-1" rowspan="1">Set the horizontal counter from <span class="register">E</span> (frame width).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="739c"></span>
<div class="comments">
<div class="paragraph">
Draw the top edge of the frame (left to right).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">BonusAnimation_TopEdge</td>
<td class="address-2"><span id="739c"></span>739C</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write the attribute byte to the attribute buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="739d"></span>739D</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move the attribute address pointer right one block.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="739e"></span>739E</td>
<td class="instruction">DJNZ <a href="730D.html#739c">BonusAnimation_TopEdge</a></td>
<td class="comment-1" rowspan="1">Decrease the horizontal counter by one and loop back to <a href="730D.html#739c">BonusAnimation_TopEdge</a> until the top edge of the frame has been drawn.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73a0"></span>73A0</td>
<td class="instruction">LD B,D</td>
<td class="comment-1" rowspan="1">Set the vertical counter from <span class="register">D</span> (frame height).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="73a1"></span>
<div class="comments">
<div class="paragraph">
Draw the right edge of the frame (top to bottom).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">BonusAnimation_RightEdge</td>
<td class="address-2"><span id="73a1"></span>73A1</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the vertical counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73a2"></span>73A2</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write the attribute byte to the attribute buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73a3"></span>73A3</td>
<td class="instruction">LD BC,$0020</td>
<td class="comment-1" rowspan="2">Move down one row (add 0020 to the attribute address).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73a6"></span>73A6</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73a7"></span>73A7</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the vertical counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73a8"></span>73A8</td>
<td class="instruction">DJNZ <a href="730D.html#73a1">BonusAnimation_RightEdge</a></td>
<td class="comment-1" rowspan="1">Decrease the vertical counter by one and loop back to <a href="730D.html#73a1">BonusAnimation_RightEdge</a> until the right edge of the frame has been drawn.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73aa"></span>73AA</td>
<td class="instruction">LD B,E</td>
<td class="comment-1" rowspan="1">Set the horizontal counter from <span class="register">E</span> (frame width).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="73ab"></span>
<div class="comments">
<div class="paragraph">
Draw the bottom edge of the frame (right to left).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">BonusAnimation_BottomEdge</td>
<td class="address-2"><span id="73ab"></span>73AB</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write the attribute byte to the attribute buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73ac"></span>73AC</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Move the attribute address pointer left one block.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73ad"></span>73AD</td>
<td class="instruction">DJNZ <a href="730D.html#73ab">BonusAnimation_BottomEdge</a></td>
<td class="comment-1" rowspan="1">Decrease the horizontal counter by one and loop back to <a href="730D.html#73ab">BonusAnimation_BottomEdge</a> until the bottom edge of the frame has been drawn.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73af"></span>73AF</td>
<td class="instruction">LD B,D</td>
<td class="comment-1" rowspan="1">Set the vertical counter from <span class="register">D</span> (frame height).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="73b0"></span>
<div class="comments">
<div class="paragraph">
Draw the left edge of the frame (bottom to top).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">BonusAnimation_LeftEdge</td>
<td class="address-2"><span id="73b0"></span>73B0</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the vertical counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73b1"></span>73B1</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write the attribute byte to the attribute buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73b2"></span>73B2</td>
<td class="instruction">LD BC,$0020</td>
<td class="comment-1" rowspan="2">Move up one row (subtract 0020 from the attribute address).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73b5"></span>73B5</td>
<td class="instruction">SBC HL,BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73b7"></span>73B7</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the vertical counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73b8"></span>73B8</td>
<td class="instruction">DJNZ <a href="730D.html#73b0">BonusAnimation_LeftEdge</a></td>
<td class="comment-1" rowspan="1">Decrease the vertical counter by one and loop back to <a href="730D.html#73b0">BonusAnimation_LeftEdge</a> until the left edge of the frame has been drawn.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="73ba"></span>
<div class="comments">
<div class="paragraph">
Move outward to the next frame.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73ba"></span>73BA</td>
<td class="instruction">LD C,$21</td>
<td class="comment-1" rowspan="2">Move up one row and left one block (subtract 0021 from the attribute address).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73bc"></span>73BC</td>
<td class="instruction">SBC HL,BC</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="73be"></span>
<div class="comments">
<div class="paragraph">
Increase the frame dimensions.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73be"></span>73BE</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="2">Increment frame width by two.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73bf"></span>73BF</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73c0"></span>73C0</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="2">Increment the frame height by two.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73c1"></span>73C1</td>
<td class="instruction">INC D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73c2"></span>73C2</td>
<td class="instruction">INC IX</td>
<td class="comment-1" rowspan="1">Increment <span class="register">IX</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73c4"></span>73C4</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73c5"></span>73C5</td>
<td class="instruction">DJNZ <a href="730D.html#7396">BonusAnimation_FrameLoop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="730D.html#7396">BonusAnimation_FrameLoop</a> until counter is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="73c7"></span>
<div class="comments">
<div class="paragraph">
Play a sound effect for the animation.
</div>
<div class="paragraph">
Note this sample is the whole thing, obviously it loops round.
</div>
<div class="paragraph">
<audio controls="" src="../audio/bonus.wav">
<p>Your browser doesn't support HTML5 audio. Here is a <a href="../audio/bonus.wav">link to the audio</a> instead.</p>
</audio>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73c7"></span>73C7</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore <span class="register">HL</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73c8"></span>73C8</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73c9"></span>73C9</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<span class="register">L</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73ca"></span>73CA</td>
<td class="instruction">AND %00001111</td>
<td class="comment-1" rowspan="1">Keep only bits 0-3.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73cc"></span>73CC</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1"><span class="register">L</span>=<span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73cd"></span>73CD</td>
<td class="instruction">LD H,B</td>
<td class="comment-1" rowspan="1"><span class="register">H</span>=<span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73ce"></span>73CE</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="6">Multiply <span class="register">HL</span> by 64.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73cf"></span>73CF</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73d0"></span>73D0</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73d1"></span>73D1</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73d2"></span>73D2</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73d3"></span>73D3</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73d4"></span>73D4</td>
<td class="instruction">LD B,$07</td>
<td class="comment-1" rowspan="1">Set a sound iteration counter to 07 loops.</td>
</tr>
<tr>
<td class="asm-label">BonusAnimation_SoundLoop</td>
<td class="address-2"><span id="73d6"></span>73D6</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash the sound iteration counter and pitch on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73d7"></span>73D7</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73d8"></span>73D8</td>
<td class="instruction">LD DE,$0002</td>
<td class="comment-1" rowspan="1">Set sound duration to 0002.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73db"></span>73DB</td>
<td class="instruction">CALL $03B5</td>
<td class="comment-1" rowspan="1">Call <a "noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/03B5.html">BEEPER</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73de"></span>73DE</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73df"></span>73DF</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the pitch value from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73e0"></span>73E0</td>
<td class="instruction">LD BC,$0014</td>
<td class="comment-1" rowspan="2">Increase the pitch value by 0014.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73e3"></span>73E3</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73e4"></span>73E4</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the sound iteration counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73e5"></span>73E5</td>
<td class="instruction">DJNZ <a href="730D.html#73d6">BonusAnimation_SoundLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the sound iteration counter by one and loop back to <a href="730D.html#73d6">BonusAnimation_SoundLoop</a> until the sound has played out.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73e7"></span>73E7</td>
<td class="instruction">POP IX</td>
<td class="comment-1" rowspan="1">Restore <span class="register">IX</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73e9"></span>73E9</td>
<td class="instruction">DEC IX</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">IX</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73eb"></span>73EB</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the inner counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73ec"></span>73EC</td>
<td class="instruction">DJNZ <a href="730D.html#7389">BonusAnimation_InnerLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the inner counter by one and loop back to <a href="730D.html#7389">BonusAnimation_InnerLoop</a> until the counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73ee"></span>73EE</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the outer counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73ef"></span>73EF</td>
<td class="instruction">DJNZ <a href="730D.html#7386">BonusAnimation_OuterLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the outer counter by one and loop back to <a href="730D.html#7386">BonusAnimation_OuterLoop</a> until the counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73f1"></span>73F1</td>
<td class="instruction">CALL <a href="6720.html">ClearScreen</a></td>
<td class="comment-1" rowspan="1">Call <a href="6720.html">ClearScreen</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73f4"></span>73F4</td>
<td class="instruction">LD BC,$00C8</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=00C8.</td>
</tr>
<tr>
<td class="asm-label">BonusDelay_Loop</td>
<td class="address-2"><span id="73f7"></span>73F7</td>
<td class="instruction">DJNZ <a href="730D.html#73f7">BonusDelay_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="730D.html#73f7">BonusDelay_Loop</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73f9"></span>73F9</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Decrease <span class="register">C</span> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73fa"></span>73FA</td>
<td class="instruction">JR NZ,<a href="730D.html#73f7">BonusDelay_Loop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="730D.html#73f7">BonusDelay_Loop</a> until <span class="register">C</span> is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="73fc"></span>
<div class="comments">
<div class="paragraph">
Self-modifying code; decrease the difficulty delay so the levels play faster.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73fc"></span>73FC</td>
<td class="instruction">LD HL,$6898</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="6890.html#6897">6898</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="73ff"></span>73FF</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="3">Jump to <a href="740C.html">InitialiseLevel</a> if the current difficulty delay is less than 04.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7400"></span>7400</td>
<td class="instruction">CP $04</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7402"></span>7402</td>
<td class="instruction">JR C,<a href="740C.html">InitialiseLevel</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7404"></span>7404</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Decrease the difficulty delay by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7405"></span>7405</td>
<td class="instruction">JR <a href="740C.html">InitialiseLevel</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="740C.html">InitialiseLevel</a>.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="72C9.html">72C9</a>
</td>
<td class="up">Up: <a href="../maps/all.html#730d">Map</a></td>
<td class="next">
Next: <a href="7407.html">7407</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Megadodo Software &copy; 2025 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/pheenix/">Source code</a>.</div>
<div><a href="../dec/asm/29453.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>