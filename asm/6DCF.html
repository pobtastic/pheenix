<!DOCTYPE html>
<html>
<head>
<title>Pheenix: Routine at 6DCF</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6CEE.html">6CEE</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6dcf">Map</a></td>
<td class="next">
Next: <a href="6EF8.html">6EF8</a>
</td>
</tr>
</table>
<div class="description">6DCF: Handler: Shield</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="6CEE.html">Handler_PlayerDeathGameOver</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Handler_Shield</td>
<td class="address-2"><span id="6dcf"></span>6DCF</td>
<td class="instruction">CALL <a href="6C9D.html">CheckCollision</a></td>
<td class="comment-1" rowspan="1">Call <a href="6C9D.html">CheckCollision</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dd2"></span>6DD2</td>
<td class="instruction">LD A,($66ED)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="66ED.html">PlayerAttributeBufferPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dd5"></span>6DD5</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Stash the player position on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dd6"></span>6DD6</td>
<td class="instruction">LD HL,$6694</td>
<td class="comment-1" rowspan="4">Jump to <a href="6DCF.html#6de8">Shield_CheckDemoMode</a> if *<a href="6694.html">ShieldTimer</a> isn't active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dd9"></span>6DD9</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dda"></span>6DDA</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ddb"></span>6DDB</td>
<td class="instruction">JR Z,<a href="6DCF.html#6de8">Shield_CheckDemoMode</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ddd"></span>
<div class="comments">
<div class="paragraph">
The players shield is active, so decrease the shield timer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ddd"></span>6DDD</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">Decrease *<a href="6694.html">ShieldTimer</a> by one.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6dde"></span>
<div class="comments">
<div class="paragraph">
Check if the timer has "wrapped around" to FF i.e. finished counting down.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dde"></span>6DDE</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="2">Jump to <a href="6DCF.html#6e20">PlayShieldSound</a> if bit 7 of *<a href="6694.html">ShieldTimer</a> is set.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6de0"></span>6DE0</td>
<td class="instruction">JR NZ,<a href="6DCF.html#6e20">PlayShieldSound</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6de2"></span>6DE2</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">Write 00 ("inactive") to *<a href="6693.html">Flag_Shield</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6de3"></span>6DE3</td>
<td class="instruction">LD ($6693),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6de6"></span>6DE6</td>
<td class="instruction">JR <a href="6DCF.html#6e20">PlayShieldSound</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6DCF.html#6e20">PlayShieldSound</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6de8"></span>
<div class="comments">
<div class="paragraph">
Check for shield activation player inputs.
</div>
<div class="paragraph">
Start by checking if the game is running in demo mode or not?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_CheckDemoMode</td>
<td class="address-2"><span id="6de8"></span>6DE8</td>
<td class="instruction">LD A,($66F3)</td>
<td class="comment-1" rowspan="3">Jump to <a href="6DCF.html#6df6">Shield_CheckKempston</a> if *<a href="66F3.html">Flag_ActiveDemoMode</a> is not active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6deb"></span>6DEB</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dec"></span>6DEC</td>
<td class="instruction">JR Z,<a href="6DCF.html#6df6">Shield_CheckKempston</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6dee"></span>
<div class="comments">
<div class="paragraph">
Demo mode is active, so use a random number to decide whether to activate the shield or not.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dee"></span>6DEE</td>
<td class="instruction">CALL <a href="670E.html">GenerateRandomNumber</a></td>
<td class="comment-1" rowspan="1">Call <a href="670E.html">GenerateRandomNumber</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6df1"></span>6DF1</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="2">Jump to <a href="6DCF.html#6e1b">Shield_ActivateShield</a> if the generated random number is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6df2"></span>6DF2</td>
<td class="instruction">JR Z,<a href="6DCF.html#6e1b">Shield_ActivateShield</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6df4"></span>6DF4</td>
<td class="instruction">JR <a href="6DCF.html#6e20">PlayShieldSound</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6DCF.html#6e20">PlayShieldSound</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6df6"></span>
<div class="comments">
<div class="paragraph">
Check if the control method is the Kempston joystick?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_CheckKempston</td>
<td class="address-2"><span id="6df6"></span>6DF6</td>
<td class="instruction">LD A,($66F6)</td>
<td class="comment-1" rowspan="3">Jump to <a href="6DCF.html#6e05">Shield_CheckAGF</a> if *<a href="66F6.html">ControlMethod</a> is not the Kempston joystick.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6df9"></span>6DF9</td>
<td class="instruction">CP $02</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dfb"></span>6DFB</td>
<td class="instruction">JR NZ,<a href="6DCF.html#6e05">Shield_CheckAGF</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6dfd"></span>
<div class="comments">
<div class="paragraph">
The control method is Kempston joystick, so test for "down" being pressed.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dfd"></span>6DFD</td>
<td class="instruction">IN A,($1F)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=read from the Kempston joystick port.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6dff"></span>6DFF</td>
<td class="instruction">AND %00000100</td>
<td class="comment-1" rowspan="2">Jump to <a href="6DCF.html#6e1b">Shield_ActivateShield</a> if "down" (bit 2) is being pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e01"></span>6E01</td>
<td class="instruction">JR NZ,<a href="6DCF.html#6e1b">Shield_ActivateShield</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e03"></span>6E03</td>
<td class="instruction">JR <a href="6DCF.html#6e20">PlayShieldSound</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6DCF.html#6e20">PlayShieldSound</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e05"></span>
<div class="comments">
<div class="paragraph">
Check if the control method is the AGF joystick?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_CheckAGF</td>
<td class="address-2"><span id="6e05"></span>6E05</td>
<td class="instruction">CP $01</td>
<td class="comment-1" rowspan="2">Jump to <a href="6DCF.html#6e13">Shield_CheckKeyboard</a> if *<a href="66F6.html">ControlMethod</a> is not the AGF joystick.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e07"></span>6E07</td>
<td class="instruction">JR NZ,<a href="6DCF.html#6e13">Shield_CheckKeyboard</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e09"></span>
<div class="comments">
<div class="paragraph">
The control method is the AGF joystick, so test for "down" being pressed.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e09"></span>6E09</td>
<td class="instruction">LD A,$EF</td>
<td class="comment-1" rowspan="2">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">EF</td>
<td class="centre" colspan="1" rowspan="1">0</td>
<td class="centre" colspan="1" rowspan="1">9</td>
<td class="centre" colspan="1" rowspan="1">8</td>
<td class="centre" colspan="1" rowspan="1">7</td>
<td class="centre" colspan="1" rowspan="1">6</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e0b"></span>6E0B</td>
<td class="instruction">IN A,($FE)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e0d"></span>6E0D</td>
<td class="instruction">BIT 4,A</td>
<td class="comment-1" rowspan="2">Jump to <a href="6DCF.html#6e1b">Shield_ActivateShield</a> if "down" ("4") was pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e0f"></span>6E0F</td>
<td class="instruction">JR Z,<a href="6DCF.html#6e1b">Shield_ActivateShield</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e11"></span>6E11</td>
<td class="instruction">JR <a href="6DCF.html#6e20">PlayShieldSound</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6DCF.html#6e20">PlayShieldSound</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e13"></span>
<div class="comments">
<div class="paragraph">
Else, the only control option left is the keyboard.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_CheckKeyboard</td>
<td class="address-2"><span id="6e13"></span>6E13</td>
<td class="instruction">LD A,$BF</td>
<td class="comment-1" rowspan="2">Read from the keyboard; <table class="default">
<tr>
<th colspan="1" rowspan="2">Port Number</th>
<th colspan="5" rowspan="1">Bit</th>
</tr>
<tr>
<th colspan="1" rowspan="1">0</th>
<th colspan="1" rowspan="1">1</th>
<th colspan="1" rowspan="1">2</th>
<th colspan="1" rowspan="1">3</th>
<th colspan="1" rowspan="1">4</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">BF</td>
<td class="centre" colspan="1" rowspan="1">ENTER</td>
<td class="centre" colspan="1" rowspan="1">L</td>
<td class="centre" colspan="1" rowspan="1">K</td>
<td class="centre" colspan="1" rowspan="1">J</td>
<td class="centre" colspan="1" rowspan="1">H</td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e15"></span>6E15</td>
<td class="instruction">IN A,($FE)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e17"></span>6E17</td>
<td class="instruction">AND %00000001</td>
<td class="comment-1" rowspan="2">Jump to <a href="6DCF.html#6e20">PlayShieldSound</a> if "ENTER" isn't being pressed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e19"></span>6E19</td>
<td class="instruction">JR NZ,<a href="6DCF.html#6e20">PlayShieldSound</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e1b"></span>
<div class="comments">
<div class="paragraph">
Activate the shield.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Shield_ActivateShield</td>
<td class="address-2"><span id="6e1b"></span>6E1B</td>
<td class="instruction">LD (HL),$FF</td>
<td class="comment-1" rowspan="1">Write FF to *<a href="6694.html">ShieldTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e1d"></span>6E1D</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="2">Write 01 to *<a href="6693.html">Flag_Shield</a> to activate it.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e1e"></span>6E1E</td>
<td class="instruction">LD (HL),$01</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e20"></span>
<div class="comments">
<div class="paragraph">
Play a sound when the shield is active (but not in demo mode).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">PlayShieldSound</td>
<td class="address-2"><span id="6e20"></span>6E20</td>
<td class="instruction">LD A,($6693)</td>
<td class="comment-1" rowspan="3">Jump to <a href="6EF8.html">Handler_ShipMovement</a> if *<a href="6693.html">Flag_Shield</a> is not active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e23"></span>6E23</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e24"></span>6E24</td>
<td class="instruction">JP Z,<a href="6EF8.html">Handler_ShipMovement</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e27"></span>6E27</td>
<td class="instruction">LD A,($66F3)</td>
<td class="comment-1" rowspan="3">Jump to <a href="6DCF.html#6e40">DrawShield</a> if *<a href="66F3.html">Flag_ActiveDemoMode</a> is active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e2a"></span>6E2A</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e2b"></span>6E2B</td>
<td class="instruction">JR NZ,<a href="6DCF.html#6e40">DrawShield</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e2d"></span>
<div class="comments">
<div class="paragraph">
Play an iteration of the shield sound effect.
</div>
<div class="paragraph">
<audio controls="" src="../audio/shield.wav">
<p>Your browser doesn't support HTML5 audio. Here is a <a href="../audio/shield.wav">link to the audio</a> instead.</p>
</audio>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e2d"></span>6E2D</td>
<td class="instruction">LD A,($6694)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=*<a href="6694.html">ShieldTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e30"></span>6E30</td>
<td class="instruction">AND %00000111</td>
<td class="comment-1" rowspan="7">Calculate the sound pitch: 00DE + ((*<a href="6694.html">ShieldTimer</a> &amp; 07) Ã— 04).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e32"></span>6E32</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e33"></span>6E33</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e34"></span>6E34</td>
<td class="instruction">LD HL,$00DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e37"></span>6E37</td>
<td class="instruction">LD D,H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e38"></span>6E38</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e39"></span>6E39</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e3a"></span>6E3A</td>
<td class="instruction">LD E,$04</td>
<td class="comment-1" rowspan="1">Set the duration in <span class="register">E</span> to 04.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e3c"></span>6E3C</td>
<td class="instruction">CALL $03B5</td>
<td class="comment-1" rowspan="1">Call <a "noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/03B5.html">BEEPER</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e3f"></span>6E3F</td>
<td class="instruction">DI</td>
<td class="comment-1" rowspan="1">Disable interrupts.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e40"></span>
<div class="comments">
<div class="paragraph">
Draws the shield graphic around the ship in the attribute buffer and screen buffer. The shield consists of two segments (left and right) that are drawn when the shield is active.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">DrawShield</td>
<td class="address-2"><span id="6e40"></span>6E40</td>
<td class="instruction">LD HL,($66ED)</td>
<td class="comment-1" rowspan="1">Load the player position from <a href="66ED.html">PlayerAttributeBufferPosition</a> into <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e43"></span>6E43</td>
<td class="instruction">LD H,$52</td>
<td class="comment-1" rowspan="1">Set <span class="register">H</span> to 52 (attribute buffer base address).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e45"></span>6E45</td>
<td class="instruction">LD B,$02</td>
<td class="comment-1" rowspan="1">Set counter in <span class="register">B</span> for 02 shield segments (left and right).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e47"></span>6E47</td>
<td class="instruction">LD A,($66A6)</td>
<td class="comment-1" rowspan="1">Load the movement animation frame counter from <a href="66A6.html">MovementAnimationFrameCounter</a> into <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e4a"></span>6E4A</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Stash the movement animation frame counter on the stack.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e4b"></span>
<div class="comments">
<div class="paragraph">
Calculate a value to be used for this shield segment based on the shield state and movement animation frame counter.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">DrawShield_SegmentLoop</td>
<td class="address-2"><span id="6e4b"></span>6E4B</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">Test if the movement animation frame counter value in <span class="register">A</span> is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e4c"></span>6E4C</td>
<td class="instruction">LD DE,$0000</td>
<td class="comment-1" rowspan="1">Initialise the value to 0000 ("<code>NOP NOP</code>").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e4f"></span>6E4F</td>
<td class="instruction">JR NZ,<a href="6DCF.html#6e62">DrawShield_SetAttribute</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6DCF.html#6e62">DrawShield_SetAttribute</a> if the movement animation frame counter is zero (use default value).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e51"></span>6E51</td>
<td class="instruction">LD A,($6694)</td>
<td class="comment-1" rowspan="3">Jump to <a href="6DCF.html#6e62">DrawShield_SetAttribute</a> if bit 2 of the shield state at *<a href="6694.html">ShieldTimer</a> is not set (shield not active).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e54"></span>6E54</td>
<td class="instruction">BIT 2,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e56"></span>6E56</td>
<td class="instruction">JR Z,<a href="6DCF.html#6e62">DrawShield_SetAttribute</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e58"></span>6E58</td>
<td class="instruction">LD DE,$0136</td>
<td class="comment-1" rowspan="1">Set the value to 0136 ("<code>LD (<span class="register">HL</span>),01</code>").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e5b"></span>6E5B</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="3">Jump to <a href="6DCF.html#6e62">DrawShield_SetAttribute</a> if this is not the second segment (<span class="register">B</span> is not 01).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e5c"></span>6E5C</td>
<td class="instruction">CP $01</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e5e"></span>6E5E</td>
<td class="instruction">JR NZ,<a href="6DCF.html#6e62">DrawShield_SetAttribute</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e60"></span>6E60</td>
<td class="instruction">LD D,$80</td>
<td class="comment-1" rowspan="1">Set the high byte of the value to 80 for the second segment.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e62"></span>
<div class="comments">
<div class="paragraph">
Store the calculated value for both shield segments using self-modifying code.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">DrawShield_SetAttribute</td>
<td class="address-2"><span id="6e62"></span>6E62</td>
<td class="instruction">LD ($6E87),DE</td>
<td class="comment-1" rowspan="1">Write the self-modifying code to the address used by the left segment (<a href="6DCF.html#6e87">6E87</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e66"></span>6E66</td>
<td class="instruction">LD ($6E9A),DE</td>
<td class="comment-1" rowspan="1">Write the self-modifying code to the address used by the right segment (<a href="6DCF.html#6e9a">6E9A</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e6a"></span>6E6A</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore the movement animation frame counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e6b"></span>6E6B</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment the movement animation frame counter value in <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e6c"></span>6E6C</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash <span class="register">BC</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e6d"></span>6E6D</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Set the loop counter in <span class="register">B</span> to the movement animation frame counter value.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e6e"></span>6E6E</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stash the attribute buffer address in <span class="register">HL</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e6f"></span>6E6F</td>
<td class="instruction">LD HL,$6E86</td>
<td class="comment-1" rowspan="1">Load the address of the left segment code to modify at (<a href="6DCF.html#6e85">6E86</a>).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e72"></span>
<div class="comments">
<div class="paragraph">
Calculate an attribute byte value based on the movement animation frame counter.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e72"></span>6E72</td>
<td class="instruction">LD A,($6694)</td>
<td class="comment-1" rowspan="1">Load the shield state from *<a href="6694.html">ShieldTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e75"></span>6E75</td>
<td class="instruction">BIT 2,A</td>
<td class="comment-1" rowspan="1">Test bit 2 of the shield state to check if the shield is active.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e77"></span>6E77</td>
<td class="instruction">LD A,$7E</td>
<td class="comment-1" rowspan="1">Set the base attribute value to INK:YELLOW,
PAPER:WHITE (BRIGHT).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e79"></span>6E79</td>
<td class="instruction">JR Z,<a href="6DCF.html#6e7d">DrawShield_AttributeLoop</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6DCF.html#6e7d">DrawShield_AttributeLoop</a> if the shield is not active (use base value).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e7b"></span>6E7B</td>
<td class="instruction">ADD A,$40</td>
<td class="comment-1" rowspan="1">Add 40 to the base attribute value (set BRIGHT bit).</td>
</tr>
<tr>
<td class="asm-label">DrawShield_AttributeLoop</td>
<td class="address-2"><span id="6e7d"></span>6E7D</td>
<td class="instruction">ADD A,$08</td>
<td class="comment-1" rowspan="1">Add 08 to the attribute value (increment PAPER colour).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e7f"></span>6E7F</td>
<td class="instruction">DJNZ <a href="6DCF.html#6e7d">DrawShield_AttributeLoop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="6DCF.html#6e7d">DrawShield_AttributeLoop</a> until counter is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e81"></span>6E81</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Write the calculated attribute byte to the storage location.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e82"></span>6E82</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore the attribute buffer address from the stack.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e83"></span>
<div class="comments">
<div class="paragraph">
Draw the left shield segment.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e83"></span>6E83</td>
<td class="instruction">LD B,$06</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for 06 lines of the left shield segment.</td>
</tr>
<tr>
<td class="asm-label">DrawShield_LeftSegment_Loop</td>
<td class="address-2"><span id="6e85"></span>6E85</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-1" rowspan="1">Set bit 0 of the attribute byte at *<span class="register">HL</span> (set INK bit 0).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e87"></span>
<div class="comments">
<div class="paragraph">
Modified by the code at <a href="6DCF.html#6e62">DrawShield_SetAttribute</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e87"></span>6E87</td>
<td class="instruction">LD (HL),$01</td>
<td class="comment-1" rowspan="1">Write 01 to the attribute buffer at *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e89"></span>6E89</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Move down one line in the attribute buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e8a"></span>6E8A</td>
<td class="instruction">DJNZ <a href="6DCF.html#6e85">DrawShield_LeftSegment_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease the left segment loop counter by one and loop back to <a href="6DCF.html#6e85">DrawShield_LeftSegment_Loop</a> until all 06 lines are drawn.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e8c"></span>6E8C</td>
<td class="instruction">LD A,($6E86)</td>
<td class="comment-1" rowspan="1">Load the attribute value from the storage location.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e8f"></span>6E8F</td>
<td class="instruction">LD ($6E99),A</td>
<td class="comment-1" rowspan="1">Store the attribute value at the address used by the right segment.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e92"></span>6E92</td>
<td class="instruction">SET 5,L</td>
<td class="comment-1" rowspan="1">Move to the right segment position (set bit 5 of <span class="register">L</span>, add 20).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e94"></span>6E94</td>
<td class="instruction">LD H,$50</td>
<td class="comment-1" rowspan="1">Set <span class="register">H</span> to 50 (screen buffer base address).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e96"></span>
<div class="comments">
<div class="paragraph">
Draw the right shield segment.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e96"></span>6E96</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">Set a counter in <span class="register">B</span> for 08 lines of the right shield segment.</td>
</tr>
<tr>
<td class="asm-label">DrawShield_RightSegment_Loop</td>
<td class="address-2"><span id="6e98"></span>6E98</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-1" rowspan="1">Set bit 0 of the pixel data at *<span class="register">HL</span> (set pixel bit 0).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6e9a"></span>
<div class="comments">
<div class="paragraph">
Modified by the code at <a href="6DCF.html#6e66">6E66</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e9a"></span>6E9A</td>
<td class="instruction">LD (HL),$01</td>
<td class="comment-1" rowspan="1">Write 01 to the screen buffer at *<span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e9c"></span>6E9C</td>
<td class="instruction">INC H</td>
<td class="comment-1" rowspan="1">Move down one pixel line in the screen buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e9d"></span>6E9D</td>
<td class="instruction">DJNZ <a href="6DCF.html#6e98">DrawShield_RightSegment_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease the right segment loop counter by one and loop back to <a href="6DCF.html#6e98">DrawShield_RightSegment_Loop</a> until all 08 lines are drawn.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6e9f"></span>6E9F</td>
<td class="instruction">LD HL,($66ED)</td>
<td class="comment-1" rowspan="1">Reload the player position from <a href="66ED.html">PlayerAttributeBufferPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ea2"></span>6EA2</td>
<td class="instruction">LD H,$52</td>
<td class="comment-1" rowspan="1">Set <span class="register">H</span> back to 52 (attribute buffer base address).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ea4"></span>6EA4</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="2">Move to the next shield segment position (increment <span class="register">L</span> by two).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ea5"></span>6EA5</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ea6"></span>6EA6</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ea7"></span>6EA7</td>
<td class="instruction">LD A,($66A6)</td>
<td class="comment-1" rowspan="1">Reload the movement animation frame counter from <a href="66A6.html">MovementAnimationFrameCounter</a> into <span class="register">A</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eaa"></span>6EAA</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Stash <span class="register">AF</span> on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eab"></span>6EAB</td>
<td class="instruction">SUB $07</td>
<td class="comment-1" rowspan="1">Decrease the movement animation frame counter by 07 to adjust for the next iteration.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ead"></span>6EAD</td>
<td class="instruction">DJNZ <a href="6DCF.html#6e4b">DrawShield_SegmentLoop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="6DCF.html#6e4b">DrawShield_SegmentLoop</a> until both shield segments are drawn.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6eaf"></span>
<div class="comments">
<div class="paragraph">
Process the shield graphic data: copy the appropriate shield sprite to the work buffer and apply bit manipulation if the shield timer is active.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eaf"></span>6EAF</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="1">Restore <span class="register">AF</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eb0"></span>6EB0</td>
<td class="instruction">LD A,($6694)</td>
<td class="comment-1" rowspan="1">Load the shield state from *<a href="6694.html">ShieldTimer</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eb3"></span>6EB3</td>
<td class="instruction">BIT 2,A</td>
<td class="comment-1" rowspan="1">Test bit 2 of the shield state to check if the shield is active.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6eb5"></span>
<div class="comments">
<div class="paragraph">
Select which shield sprite to use based on the shield state.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eb5"></span>6EB5</td>
<td class="instruction">LD HL,$6014</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> to point to the first shield sprite at <a href="6014.html">Graphics_Shield_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eb8"></span>6EB8</td>
<td class="instruction">JR Z,<a href="6DCF.html#6ebd">DrawShield_CopySprite</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6DCF.html#6ebd">DrawShield_CopySprite</a> if the shield is not active (use first sprite).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eba"></span>6EBA</td>
<td class="instruction">LD HL,$601D</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> to point to the second shield sprite at <a href="6014.html#601d">Graphics_Shield_02</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ebd"></span>
<div class="comments">
<div class="paragraph">
Copy the shield sprite data (09 bytes) to the work buffer at <a href="615B.html#617b">617B</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">DrawShield_CopySprite</td>
<td class="address-2"><span id="6ebd"></span>6EBD</td>
<td class="instruction">LD DE,$617B</td>
<td class="comment-1" rowspan="1">Set <span class="register">DE</span> to point to the work buffer at <a href="615B.html#617b">617B</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ec0"></span>6EC0</td>
<td class="instruction">LD C,$09</td>
<td class="comment-1" rowspan="1">Set the shield byte count in <span class="register">C</span> to 09.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ec2"></span>6EC2</td>
<td class="instruction">LDIR</td>
<td class="comment-1" rowspan="1">Copy the shield sprite data from <span class="register">HL</span> to the work buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ec4"></span>6EC4</td>
<td class="instruction">LD A,($66A6)</td>
<td class="comment-1" rowspan="3">Jump to <a href="6DCF.html#6ee1">DrawPlayersShip</a> if the movement animation frame counter at *<a href="66A6.html">MovementAnimationFrameCounter</a> is zero (skip bit manipulation).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ec7"></span>6EC7</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ec8"></span>6EC8</td>
<td class="instruction">JR Z,<a href="6DCF.html#6ee1">DrawPlayersShip</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6eca"></span>
<div class="comments">
<div class="paragraph">
Apply bit manipulation to the shield graphic data based on the movement animation frame counter value.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eca"></span>6ECA</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Load the movement animation frame counter from *<a href="66A6.html">MovementAnimationFrameCounter</a> into <span class="register">B</span> (outer loop counter).</td>
</tr>
<tr>
<td class="asm-label">DrawShield_RotateLoop</td>
<td class="address-2"><span id="6ecb"></span>6ECB</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Stash the outer loop counter on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ecc"></span>6ECC</td>
<td class="instruction">LD HL,$617B</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> to point to the work buffer at <a href="615B.html#617b">617B</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ecf"></span>6ECF</td>
<td class="instruction">LD B,$09</td>
<td class="comment-1" rowspan="1">Set counter in <span class="register">B</span> for 09 bytes (one complete pass).</td>
</tr>
<tr>
<td class="asm-label">DrawShield_RotateByte</td>
<td class="address-2"><span id="6ed1"></span>6ED1</td>
<td class="instruction">SLA (HL)</td>
<td class="comment-1" rowspan="1">Shift the byte at *<span class="register">HL</span> left by one bit.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed3"></span>6ED3</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next byte in the work buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed4"></span>6ED4</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-1" rowspan="1">Test bit 7 of the next byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed6"></span>6ED6</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Move back to the previous byte.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed7"></span>6ED7</td>
<td class="instruction">JR Z,<a href="6DCF.html#6edb">DrawShield_RotateNext</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="6DCF.html#6edb">DrawShield_RotateNext</a> if bit 7 was not set (no carry to propagate).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ed9"></span>6ED9</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-1" rowspan="1">Set bit 0 of the current byte (propagate the carry).</td>
</tr>
<tr>
<td class="asm-label">DrawShield_RotateNext</td>
<td class="address-2"><span id="6edb"></span>6EDB</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Move to the next byte in the work buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6edc"></span>6EDC</td>
<td class="instruction">DJNZ <a href="6DCF.html#6ed1">DrawShield_RotateByte</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="6DCF.html#6ed1">DrawShield_RotateByte</a> until all 09 bytes are processed.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ede"></span>6EDE</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the outer loop counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6edf"></span>6EDF</td>
<td class="instruction">DJNZ <a href="6DCF.html#6ecb">DrawShield_RotateLoop</a></td>
<td class="comment-1" rowspan="1">Decrease the outer loop counter by one and loop back to <a href="6DCF.html#6ecb">DrawShield_RotateLoop</a> until the shield timer value is reached.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6ee1"></span>
<div class="comments">
<div class="paragraph">
Draws the player's ship sprite to the screen buffer. The ship graphic is copied from the work buffer at <a href="615B.html#617b">617B</a>, which may have been modified by the shield bit manipulation routine.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">DrawPlayersShip</td>
<td class="address-2"><span id="6ee1"></span>6EE1</td>
<td class="instruction">LD DE,($66ED)</td>
<td class="comment-1" rowspan="1">Load the player position from <a href="66ED.html">PlayerAttributeBufferPosition</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ee5"></span>6EE5</td>
<td class="instruction">LD D,$50</td>
<td class="comment-1" rowspan="1">Set <span class="register">D</span> to 50 (screen buffer base address).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ee7"></span>6EE7</td>
<td class="instruction">LD HL,$617B</td>
<td class="comment-1" rowspan="1">Set <span class="register">HL</span> to point to the ship graphic data in the work buffer at <a href="615B.html#617b">617B</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eea"></span>6EEA</td>
<td class="instruction">LD B,$03</td>
<td class="comment-1" rowspan="1">Set counter in <span class="register">B</span> for 03 pixel rows (ship sprite height).</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="6eec"></span>
<div class="comments">
<div class="paragraph">
Draw each row of the ship sprite (3 bytes per row, 3 rows total).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">DrawPlayersShip_Loop</td>
<td class="address-2"><span id="6eec"></span>6EEC</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="2">Stash the row counter and screen position on the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eed"></span>6EED</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6eee"></span>6EEE</td>
<td class="instruction">LD BC,$0003</td>
<td class="comment-1" rowspan="1">Set a row counter in <span class="register">BC</span> to 0003 bytes.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ef1"></span>6EF1</td>
<td class="instruction">LDIR</td>
<td class="comment-1" rowspan="1">Copy the ship graphic row from <span class="register">HL</span> to the screen buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ef3"></span>6EF3</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the screen position from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ef4"></span>6EF4</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Move down one pixel line in the screen buffer.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ef5"></span>6EF5</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore the row counter from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="6ef6"></span>6EF6</td>
<td class="instruction">DJNZ <a href="6DCF.html#6eec">DrawPlayersShip_Loop</a></td>
<td class="comment-1" rowspan="1">Decrease counter by one and loop back to <a href="6DCF.html#6eec">DrawPlayersShip_Loop</a> until all 03 rows are drawn.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<div class="comments">
<div class="paragraph">
Continue on to <a href="6EF8.html">Handler_ShipMovement</a>.
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="6CEE.html">6CEE</a>
</td>
<td class="up">Up: <a href="../maps/all.html#6dcf">Map</a></td>
<td class="next">
Next: <a href="6EF8.html">6EF8</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1983 Megadodo Software &copy; 2025 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.6.</div>
<div class="repository">Link to <a rel="noopener nofollow" href="https://github.com/pobtastic/pheenix/">Source code</a>.</div>
<div><a href="../dec/asm/28111.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>